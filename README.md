# О скрипте
Скрипт автоматизирует настройку маршрутизации трафика виртуальных машин (ВМ) поведенческого анализа через выделенный сетевой интерфейс.
Скрипт модифицирует конфигурацию netplan, добавляя правила для текущего набора подсетей ВМ.

Скрипт может быть добавлен в cron и выполняться с заданной периодичностью

# Описание задачи
Каждая ВМ живет в своей подсети (169.254.*.*/27) из которой она выходит через NAT-адрес. Всего таких адресов = `(max количество ловушек ПА)\*(количество различных образов ПА)`.
То есть если на устройстве хватает ресурсов на 15 ВМ ПА и используется 3 различных образа ВМ, то будет 15\*3=45 NAT-адресов, которые надо направить на другой шлюз и на сам адрес интерфейса.

Чтобы получить список NAT-адресов необходимо выполнить следующую команду:
`grep -R tunnel-network /mnt/images/win*/subimage-*.json`

При обновление образа ВМ, либо при появлении нового образа происходит процедура пересоздания пула ВМ, в результате которой виртуальным машинам назначаются новые сетевые адреса\подсети и требуется перенастройка ранее созданных правил маршрутизации.

# Требования для работы скрипта
- установлен python3
- cетевые настройки ОС задаются через netplan
- создана отдельная таблица маршрутизаци
`echo 200 custom_table >> /etc/iproute2/rt_tables`
